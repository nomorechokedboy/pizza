build:
  pizza-prod:
    args:
      env: prod
    context: .
    cache_from:
      - nomorechokedboy/web-project:pizza-api-prod
    dockerfile: ./apps/express/Dockerfile
    export_cache: pizza-api-cache
    image: nomorechokedboy/web-project:pizza-api-prod
deploy:
  - kubectl create secret generic pizza-env --from-literal=MORGAN=1 --from-literal=SECRET_KEY=${SECRET_KEY} --from-literal=refreshTokenKey=${refreshTokenKey} --from-literal=REDIS_HOST=redis --from-literal=REDIS_PORT=6379 --from-literal=PIZZA_SERVER_PORT=${PIZZA_SERVER_PORT} --from-literal=MONGODB=$MONGO_HOST://$MONGO_USER:$MONGO_PASSWORD@stikinote.bzd5w.mongodb.net/$PIZZA_DB?retryWrites=true&w=majority
  - kubectl apply -f k8s/redis.yml
  - kubectl apply -f k8s/api-svc.yml
  - kubectl apply -f k8s/api-deployment.yml
